\chapter{Differentiation}
\section{Derivatives}
\begin{definition}
  Let $f: D \to \mathbb{R}$ be a map with $D \subseteq \mathbb{R}$.
  For each $a \in \mathbb{R}$ such that $(a - \delta, a + \delta) \subseteq D$
  for some $\delta > 0$, we define the \emph{derivative} of $f$ at $a$ by
  \begin{equation*}
    f'(a) = \lim_{h \to 0} \frac{f(a + h) - f(a)}{h}.
  \end{equation*}
  We say that $f$ is \emph{differentiable} at $a$ if $f'(a)$ exists.
\end{definition}

\begin{theorem}
  Let $f: D \to \mathbb{R}$ be a map with $D \subseteq \mathbb{R}$.
  For each $a \in \mathbb{R}$ such that $(a - \delta, a + \delta) \subseteq D$
  for some $\delta > 0$, if $f$ is differentiable at $a$, then $f$ is
  continuous at $a$.
\end{theorem}
\begin{proof}
  We have
  \begin{align*}
    \lim_{x \to a} f(x)
    &= \lim_{h \to 0} f(a + h) \\
    &= \lim_{h \to 0} \left(f(a) + \frac{f(a + h) - f(a)}{h} \cdot h\right) \\
    &= f(a) + f'(a) \cdot 0 \\
    &= f(a).
    \qedhere
  \end{align*}
\end{proof}

\begin{theorem}
  Let $f$ and $g$ be real functions.
  If both $f$ and $g$ are differentiable at $a \in \mathbb{R}$, then the
  following statements are true.
  \begin{enumerate}
    \item $f + g$ is differentiable at $a$, and $(f + g)'(a) = f'(a) + g'(a)$.
    \item $f \cdot g$ is differentiable at $a$, and
    $(f \cdot g)'(a) = f'(a) \cdot g(a) + f(a) \cdot g'(a)$.
    \item If $g(a) \neq 0$, then $1 /g$ is differentiable at $a$, and
    $(1 / g)'(a) = -g'(a) / (g(a))^2$.
  \end{enumerate}
\end{theorem}
\begin{proof}
  \leavevmode
  \begin{enumerate}
    \item We have
    \begin{align*}
      (f + g)'(a)
      &= \lim_{h \to 0} \frac{(f + g)(a + h) - (f + g)(a)}{h} \\
      &= \lim_{h \to 0} \left(\frac{f(a + h) - f(a)}{h}
      + \frac{g(a + h) - g(a)}{h}\right) \\[.3em]
      &= f'(a) + g'(a).
    \end{align*}
    \item We have
    \begin{align*}
      (f \cdot g)'(a)
      &= \lim_{h \to 0} \frac{(f \cdot g)(a + h) - (f \cdot g)(a)}{h} \\
      &= \lim_{h \to 0} \frac{f(a + h)g(a + h) - f(a)g(a + h) + f(a)g(a + h)
      - f(a)g(a)}{h} \\
      &= \lim_{h \to 0} \left(\frac{f(a + h) - f(a)}{h} \cdot g(a + h)
      + f(a) \cdot \frac{g(a + h) - g(a)}{h}\right) \\[.3em]
      &= f'(a) \cdot g(a) + f(a) \cdot g'(a).
    \end{align*}
    \item We have
    \begin{align*}
      \left(\frac{1}{g}\right)'(a)
      &= \lim_{h \to 0} \frac{(1/g)(a + h) - (1/g)(a)}{h} \\
      &= \lim_{h \to 0} \frac{g(a) - g(a + h)}{hg(a)g(a + h)} \\
      &= \frac{-g'(a)}{(g(a))^2}.
      \qedhere
    \end{align*}
  \end{enumerate}
\end{proof}

\begin{theorem}[Chain Rule]
  Let $f$ and $g$ be real functions.
  If $f$ is differentiable at $a \in \mathbb{R}$ and $g$ is differentiable at
  $f(a)$, then $g \circ f$ is differentiable at $a$, and
  \begin{equation*}
    (g \circ f)'(a) = g'(f(a)) \cdot f'(a).
  \end{equation*}
\end{theorem}
\begin{proof}
  Let
  \begin{equation*}
    u(x, h) =
    \begin{cases}
      0, &\text{if $h = 0$} \\[0.5em]
      \displaystyle \frac{f(x + h) - f(x)}{h} - f'(x), &\text{otherwise}
    \end{cases}
  \end{equation*}
  and
  \begin{equation*}
    v(y, k) =
    \begin{cases}
      0, &\text{if $k = 0$} \\[0.5em]
      \displaystyle \frac{g(y + k) - g(y)}{k} - g'(y), &\text{otherwise}.
    \end{cases}
  \end{equation*}
  Note that we have
  \begin{align*}
    f(x + h) &= f(x) + h \cdot (f'(x) + u(x, h)) \\
    g(y + k) &= g(y) + k \cdot (g'(y) + v(y, k)).
  \end{align*}
  Then for every $h \neq 0$ we have
  \begin{align*}
    \frac{g(f(a + h)) - g(f(a))}{h}
    &= \frac{(f(a + h) - f(a)) \cdot (g'(f(a)) + v(f(a), f(a + h) - f(a)))}{h}
    \\
    &= (f'(a) + u(a, h)) \cdot (g'(f(a)) + v(f(a), (f'(a) + u(a, h))h)).
  \end{align*}
  Since
  \begin{equation*}
    \lim_{h \to 0} u(x, h) = 0
    \qquad \text{and} \qquad
    \lim_{k \to 0} v(y, k) = 0,
  \end{equation*}
  it follows that
  \begin{equation*}
    (g \circ f)'(a)
    = \lim_{h \to 0} \frac{g(f(a + h)) - g(f(a))}{h}
    = f'(a) \cdot g'(f(a)).
    \qedhere
  \end{equation*}
\end{proof}

\section{The Mean Value Theorem}
\begin{theorem}
  Let $f$ be a real function.
  If $f$ has a local maximum at $a$ and $f$ is differentiable at $a$,
  then $f'(a) = 0$.
\end{theorem}
\begin{proof}
  Assume for contradiction that $f'(a) \neq 0$.
  Choose $\delta > 0$ such that $f(x) \leq f(a)$ and
  \begin{equation*}
    \left|\frac{f(x) - f(a)}{x - a} - f'(a)\right| < \frac{|f'(a)|}{2}
  \end{equation*}
  hold for all $x \in (a - \delta, a + \delta)$.
  If $f'(a) > 0$, then
  \begin{equation*}
    f(x) - f(a) > \frac{f'(a)(x - a)}{2} > 0
  \end{equation*}
  for all $x \in (a, a + \delta)$, contradiction.
  If $f'(a) < 0$, then
  \begin{equation*}
    f(x) - f(a) > \frac{f'(a)(x - a)}{2} > 0
  \end{equation*}
  for all $x \in (a - \delta, a)$, contradiction.
  Thus, $f'(a) = 0$.
\end{proof}

\begin{theorem}[Rolle's Theorem]
  Let $f$ be a real function that is continuous on $[a, b]$ and is
  differentiable on $(a, b)$.
  If $f(a) = f(b)$, then there exists $c \in (a, b)$ such that $f'(c) = 0$.
\end{theorem}
\begin{proof}
  Let $c^+, c^- \in [a, b]$ such that $f(c^-) \leq f(x) \leq f(c^+)$ for all
  $x \in [a, b]$.
  If $\{c^+, c^-\} = \{a, b\}$, then $f$ is a constant function, and thus
  $f'(c) = 0$ for all $c \in (a, b)$.
  Otherwise, let $c \in \{c^+, c^-\} \setminus \{a, b\}$, and we have
  $f'(c) = 0$.
\end{proof}

\begin{theorem}[Mean Value Theorem]
  Let $f$ be a real function that is continuous on $[a, b]$ and is
  differentiable on $(a, b)$.
  Then there exists $c \in (a, b)$ such that
  \begin{equation*}
    f'(c) = \frac{f(a) - f(b)}{a - b}.
  \end{equation*}
\end{theorem}
\begin{proof}
  Define $g: [a, b] \to \mathbb{R}$ with
  \begin{equation*}
    g(x) = f(x) - f(a) - \frac{f(a) - f(b)}{a - b} \cdot (x - a).
  \end{equation*}
  Note that $g$ is continuous on $[a, b]$ and is differentiable on $(a, b)$.
  Also we have $g(a) = g(b) = 0$.
  Thus, there exists $c \in (a, b)$ with $g'(c) = 0$.
  Since
  \begin{equation*}
    g'(x) = f'(x) - \frac{f(a) - f(b)}{a - b}
  \end{equation*}
  holds for all $x \in (a, b)$, we have
  \begin{equation*}
    f'(c) = \frac{f(a) - f(b)}{a - b}.
    \qedhere
  \end{equation*}
\end{proof}
